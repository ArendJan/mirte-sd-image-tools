name: Build and Upload

on:
    push:
    schedule:
      - cron: '0 4 * * 1' # every Monday at 4:00 AM # TODO: branch gebeuren....
permissions:
    contents: write
  
jobs:
    shellcheck:
      uses: ./.github/workflows/shellcheck.yml
    shfmt:
      uses: ./.github/workflows/shfmt.yml
    repocheck:
      uses: ./.github/workflows/repocheck.yml
    build-and-push:
        needs: [shellcheck, shfmt, repocheck]
        strategy:
            matrix:
                image: [ 
                        mirte_orangepizero2,
                        mirte_orangepi3b
                        ]
            fail-fast: false
        uses: ./.github/workflows/build_single.yaml
        with:
          sbc: ${{ matrix.image }}
        if:  ${{ ! startsWith(github.event.head_commit.message, 'x') }}

        secrets: inherit
    master-build-and-push:
        needs: [shellcheck, shfmt, repocheck]
        if:  ${{ ! startsWith(github.event.head_commit.message, 'x') }}
        # strategy:
        #     matrix:
        #         image: [ 
        #                 # mirte_orangepizero2,
        #                 mirte_orangepi3b
        #                 ]
        #     fail-fast: false
        uses: ./.github/workflows/build_single.yaml
        with:
          mirte_type: mirte-master
          sbc: mirte_orangepi3b
        secrets: inherit
      
            
